<!DOCTYPE html>
<html>
<head>
<title> Not KaHoot  </title>
</head>
<script src="/socket.io/socket.io.js"></script>

<body>
    <h2 id="quiz-name">Quiz name not set</h2>
    <h1 id="question-text"></h1>
    <div id="answeres" > 
        <button onclick="sendName()">Name</button> <input type="text" id="user-name">
       
    </div>


</body>
<script>


    //Gathering the quiz ID out of the url. 
    let url = new URL(document.URL);
    quizId=new URL(document.URL).searchParams.get("quizId");
    console.log(quizId);

    var userName; //This holds the name the user picked for the quiz. 

    var socket = io();

    function setQuizTitle(title){
        var quizNameEl = document.getElementById("quiz-name");
        quizNameEl.textContent = title;
    };

    function setQuestionText(title){
        var questionNameEl = document.getElementById("question-text");
        questionNameEl.textContent = title;
    };

    function setAnswers(answers){

        var answeresDiv = document.getElementById("answeres");
        answeresDiv.innerHTML = "";
        for (x in answers){
            var answer = document.createElement("h3");
            answer.setAttribute("id","answer"+x);
            answer.textContent = answers[x].text;
            answeresDiv.appendChild(answer);
        }
    };


    function sendName(){
        var nameEl = document.getElementById("user-name");
        if( nameEl.value == ""){
            alert("You must choose a name");
        }
        else{
            userName = nameEl.value;
            //This sends the name to the server. 
            console.log("Sending to server: "+ {"quizId": quizId, "name": nameEl.value});
            socket.emit("quiz-lobby-name",{"quizId": quizId, "name": nameEl.value});
            var answeresDiv = document.getElementById("answeres");
            answeresDiv.innerHTML = "Waiting for quiz to start.";}
    }

    //need: quizName, quizQuestion, quizAnswers
    /*This is for recieving quiz information*/
    socket.on('quiz-client',function(QuizCreate){
        console.log(QuizCreate);
        setQuizTitle(QuizCreate.name);
        if('question' in QuizCreate){
            setQuestionText(QuizCreate.question.text);
            setAnswers(QuizCreate.question.answers);
        }

      });


    // -------On Server-----------------  
    //   io.emit('quiz-client',{
    //     name : QuizCreate.name,
    //     question : QuizCreate.questions[0]
    // }); 
    // This should be sent to a specific client.
    // QuizCreate is a complete quiz object. 



    socket.emit('start-quiz',quizId);



</script>
</html>
