<!DOCTYPE html>
<html>
<head>
<title> Not KaHoot  </title>
</head>
<script src="/socket.io/socket.io.js"></script>

<body>
    <h2 id="quiz-name">Quiz name</h2>
    <h1 id="question-text"></h1>
    <div id="answeres" > 
        <h3 id="quiz-id">Log on with quiz id: </h3>
        <button type="button" onclick="startQuiz()" > Start Quiz </button> <br>
        <div id="people-in-quiz"></div>
    </div>
	
</body>
<script>


    //---Gathering the quiz ID out of the url. 
    let url = new URL(document.URL);
    quizId=new URL(document.URL).searchParams.get("quizId");
    console.log(quizId);
    var quizIdEl = document.getElementById("quiz-id");
    quizIdEl.innerHTML+=quizId;
    //---

    var socket = io();

    function setQuizTitle(title){
        var quizNameEl = document.getElementById("quiz-name");
        quizNameEl.textContent = title;
    };

    function setQuestionText(title){
        var questionNameEl = document.getElementById("question-text");
        questionNameEl.textContent = title;
    };

    function setAnswers(answers){

        var answeresDiv = document.getElementById("answeres");
        answeresDiv.innerHTML = "";
        for (x in answers){
            var answer = document.createElement("h3");
            answer.setAttribute("id","answer"+x);
            answer.textContent = answers[x].text;
            answeresDiv.appendChild(answer);
        }
    };

    function addName(Name){
        var lobbyEl = document.getElementById("people-in-quiz");
        var nameSpan = document.createElement('h4');
        nameSpan.textContent = Name;
        lobbyEl.appendChild(nameSpan);
    }

    function startQuiz(){
        socket.emit('start', quizId);
    }

    //need: quizName, quizQuestion, quizAnswers
    /*This is for recieving quiz information*/
    socket.on('quiz-client',function(QuizCreate){
        console.log(QuizCreate);
        setQuizTitle(QuizCreate.name);
        if('question' in QuizCreate){
            setQuestionText(QuizCreate.question.text);
            setAnswers(QuizCreate.question.answers);
        }

      });
      
        // -------On Server-----------------  
        //   io.emit('quiz-client',{
        //     name : QuizCreate.name,
        //     question : QuizCreate.questions[0]
        // }); 
        // This should be sent to a specific client.
        // QuizCreate is a complete quiz object. 

    socket.on("quiz-join-name", function(nameObj){
        if(quizId == nameObj["quizId"]){
            console.log(nameObj);
            addName(nameObj["name"]);
        }
      });



    socket.emit('start-quiz',quizId);



</script>
</html>
